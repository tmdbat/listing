(function(n){var f=window.AmazonUIPageJS||window.P,r=f._namespace||f.attributeErrors,e=r?r("PageRefreshAsset",""):f;e.guardFatal?e.guardFatal(n)(e,window):e.execute(function(){n(e,window)})})(function(n,f,r){n.when("A","page-refresh-state","web-ajax-utility","alt-page-refresh-measurement","state-aware-feature-consolidator","page-refresh-utils","dp-interactive-page-refresh-handler").register("page-refresh-handler",function(e,h,l,c,d,b,k){var a={},g=e.$,t={},u="",q,m=function(a,h,f,m,n){var p=this;
p.clientId=a;p.clientName=h.toLowerCase();p.doPageRefresh=function(b,c,h){var q,m;m="";q=b["Non-Persistent"];q.hasOwnProperty("triggerEvent")&&(m=q.triggerEvent);if(m!==r&&""!==m&&" "!==m){q=d.getStateAwareParameters();var p;t=g.extend(!0,t,b.Persistent);w();m=e.copy(u);g.extend(!0,m,t,b["Non-Persistent"],q);b=f;q=e.contains(b,"?");b+=q?"\x26":"?";m=x(m);for(p in m)if(null!=m[p]){q=m[p];var v=b.slice(-1);b+="?"===v||"\x26"===v?"":"\x26";b+=p+"\x3d"+q}p=b;k.createInteractivityObjectForTwisterUpdate();
l.getInstance(a,p,c,h,n).getContent()}else throw"triggerEvent parameter missing or invalid";};p.addParams=function(a){t=g.extend(!0,t,a);return!0};p.removeParams=function(a){e.each(a,function(a,b){delete t[a];delete u[a]});return!0};p.createCustomParamsMap=function(a,b){var c={Persistent:{},"Non-Persistent":{}};g.each(a,function(a,b){c.Persistent[a]=b});g.each(b,function(a,b){c["Non-Persistent"][a]=b});return c};p.startMeasurement=function(a,b,c,g,k,d){this.pageRefreshMeasurement&&this.pageRefreshMeasurement.start(a,
b,c,g,k,d)};p.stampImageLoad=function(a){this.pageRefreshMeasurement&&this.pageRefreshMeasurement.stampImageLoad(a)};p.stampFeature=function(a,b){this.pageRefreshMeasurement&&this.pageRefreshMeasurement.stampFeature(a,b)};p.fadeInFeatures=function(a){"undefined"!==typeof a&&a.length||(a=q[p.clientName]);b.fadeInFeatures(a)};var w=function(){g.each(u,function(a,b){t.hasOwnProperty(a)&&(u[a]=t[a])})},x=function(a){var b={},c=Object.keys(a);c.sort();g.each(c,function(c,g){b[g]=a[g]});return b};(function(){if(m){var a=
m.config;p.pageRefreshMeasurement=new c(g,a.atf.marker,a.cf.marker);p.pageRefreshMeasurement.init(m.storeID,m.productGroupID,m.triggerEvent)}})()};(function(){var a=h.fetchPageRefreshData();u=a.pageRefreshUrlParams;q=a.divToUpdateData})();return{getHandlerInstance:function(b,c,g,k){(null==b||""===b)&&f.ueLogError&&f.ueLogError({message:"Invalid ClientId"},{logLevel:"FATAL",attribution:"PageRefreshAPI",message:"Invalid ClientId passed to getHandlerInstance of dpRefreshHandler"});a[b]||(a[b]=new m(b,
c,g,k));return a[b]},getPersistentParams:function(){return t}}});"use strict";n.when("A","page-refresh-handler").register("dp-refresh-handler",function(e,h){function l(c,d,b,k){this.featureTriggeringRefresh=c.featureName;this.deviceTypeStateData=e.state("detail-page-device-type");"undefined"===typeof this.deviceTypeStateData&&(this.deviceTypeStateData=e.state("page-refresh-device-type"));this.deviceType=this.deviceTypeStateData&&this.deviceTypeStateData.deviceType?this.deviceTypeStateData.deviceType:
"web";this.pageRefreshUrl=b&&b.pageRefreshUrl?b.pageRefreshUrl:"/gp/page/refresh";this.clientId="PageRefresh_"+this.deviceType+"_"+this.featureTriggeringRefresh+"_Client";this.DPRefreshHandler=h.getHandlerInstance(this.clientId,this.featureTriggeringRefresh,this.pageRefreshUrl,d,k)}l.prototype={doPageRefresh:function(c,d,b){try{this.DPRefreshHandler.doPageRefresh(c,d,b)}catch(k){f.ueLogError&&f.ueLogError(k,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the doPageRefresh method triggered by - "+
this.featureTriggeringRefresh+": "+k})}},createCustomParamsMap:function(c,d){var b={};try{b=this.DPRefreshHandler.createCustomParamsMap(c,d)}catch(k){f.ueLogError&&f.ueLogError(k,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the createCustomParamsMap method triggered by - "+this.featureTriggeringRefresh+": "+k})}return b},addParams:function(c){return c&&"object"==typeof c?this.DPRefreshHandler.addParams(c):!1},removeParams:function(c){return c&&"object"==
typeof c?this.DPRefreshHandler.removeParams(c):!1},startMeasurement:function(c,d,b,k,a,g){try{this.DPRefreshHandler.startMeasurement(c,d,b,k,a,g)}catch(e){f.ueLogError&&f.ueLogError(e,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the startMeasurement method triggered by - "+this.featureTriggeringRefresh+": "+e})}},stampImageLoad:function(c){try{this.DPRefreshHandler.stampImageLoad(c)}catch(d){f.ueLogError&&f.ueLogError(d,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,
message:"This error is caused by the startMeasurement method triggered by - "+this.featureTriggeringRefresh+": "+d})}},stampFeature:function(c,d){try{this.DPRefreshHandler.stampFeature(c,d)}catch(b){f.ueLogError&&f.ueLogError(b,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the startMeasurement method triggered by - "+this.featureTriggeringRefresh+": "+b})}},fadeInFeatures:function(c){try{this.DPRefreshHandler.fadeInFeatures(c)}catch(d){f.ueLogError&&
f.ueLogError(d,{logLevel:"ERROR",attribution:this.featureTriggeringRefresh,message:"This error is caused by the fadeInFeatures method triggered by - "+this.featureTriggeringRefresh+": "+d})}}};return l});n.when("A","jQuery","dp-interactive-page-refresh-handler","dp-click-to-ci-utils").register("alt-page-refresh-ajax-scope",function(e,h,l,c){return function(d,b,k,a,g){this.scopeName=b;this.url=k;this.customPageTypeId=a;this.customTags=g;this.requestIdAvailable=!1;ues("t0",b,f.newTwisterInteractionStartTime);
ues("ctb",b,"1");this.signalMarker=function(a){!this.markers[a]||0>=this.markers[a].conditions||0===--this.markers[a].conditions&&"function"==typeof this.markers[a].handler&&this.markers[a].handler()};this.addlongPoleTag=function(a,b){a=a.toLowerCase();this.markers[a]&&0==this.markers[a].conditions&&0==this.markers[a].conditions&&f.ue&&"function"===typeof ue.tag&&ue.tag(b)};this.markClickToCI=function(){var a=this,b=l.getClickToCIMetric();b&&b.then(function(b){uet("fn",a.scopeName,r,b.interactiveTime);
a.requestIdAvailable&&uex("ld",lScopeName);c.logCounter("TTISuccessCountForTwisterUpdate")}).catch(function(a){c.logCounter("TTIFailureCountForTwisterUpdate")})};this.postData=function(){var a=this.scopeName,b=this.customPageTypeId,c=this.customTags;d.ajax({url:this.url,dataType:"text",timeout:4E4,error:function(){},success:function(g,k,d){g=g.trim();ues("id",a,g);this.requestIdAvailable=!0;var e;b!==r&&(e=f.ue_pti,f.ue_pti=b);if(c!==r)for(g=0;g<c.length;g++)ue.tag(c[g]);uex("ld",a);b!==r&&(f.ue_pti=
e)}})};var h=this;this.markers={image:{conditions:1,handler:function(){uet("ne",b);h.signalMarker("af")}},af:{conditions:Twister.atfMarkerCount?Twister.atfMarkerCount:2,handler:function(){e.trigger("PageRefresh:ATF");uet("af",b);uet("cf",b);h.signalMarker("cf");l.updateCriticalFeatures();h.markClickToCI()}},cf:{conditions:Twister.cfMarkerCount?Twister.cfMarkerCount:2,handler:function(){e.trigger("PageRefresh:CF");uet("cf",b);h.postData()}}}}});n.when("A","jQuery","alt-page-refresh-ajax-scope").register("alt-page-refresh-measurement",
function(e,h,l){return function(c,d,b){this.atfMarker=d;this.cfMarker=b;this.scopeCount={};this.ajaxScopes={};this.url="";this.init=function(b,a,c){this.url="/gp/twister/dynamic-update/ajax-measurement.html/?s\x3d"+b+"\x26pgid\x3d"+a+"\x26deviceType\x3d"+Twister.deviceType+"\x26triggerEvent\x3d"+c;Twister.isInstaTwisterEnabled&&(this.url+="\x26ptd\x3d"+Twister.productTypeName)};this.start=function(b,a,g,d,e,h){if(f.ue){this.scopeCount[b]||(this.scopeCount[b]=0);var m=b+(this.scopeCount[b]+1);this.scopeCount[b]++;
var n=this.url;a&&(n+="\x26dimensionType\x3d"+a);"undefined"!==typeof g&&(n+="\x26dimensionCount\x3d"+g);"undefined"!==typeof d&&(n+="\x26dimensionsDisplayType\x3d"+d);this.ajaxScopes[b]=new l(c,m,n,e,h)}};this.stampImageLoad=function(b){this.ajaxScopes[b]&&(this.ajaxScopes[b].signalMarker("image"),Twister.cfImageLongPollTag&&this.ajaxScopes[b].addlongPoleTag("cf",Twister.cfImageLongPollTag))};this.stampFeature=function(b,a){this.ajaxScopes[a]&&(b===this.atfMarker&&this.ajaxScopes[a].signalMarker("af"),
b===this.cfMarker&&(this.ajaxScopes[a].signalMarker("cf"),Twister.cfHtmlLongPollTag&&this.ajaxScopes[a].addlongPoleTag("cf",Twister.cfHtmlLongPollTag)))};this.stampCustomMetrics=function(b,a){this.ajaxScopes[a]&&uet(b,this.ajaxScopes[a].scopeName)}}});n.when("A","ready","page-refresh-js-init-dpx-data","page-refresh-js-init-mason-data").register("page-refresh-state",function(e,h,l,c){function d(){var a=b.extend(!0,{},l.divToUpdateData,c.divToUpdateData),g={};e.each(a,function(a,b){g[b]=[];e.each(a,
function(a){(a=a.divToUpdate)&&g[b].push(a)})});return g}var b=e.$,k=e.state("page-refresh-data-mason"),a=e.state("page-refresh-data-dpx"),g=e.state("detail-page-device-type"),f={};"undefined"===typeof g&&(g=e.state("page-refresh-device-type"));return{fetchPageRefreshData:function(){var c=k&&k.pageRefreshUrlParams?k.pageRefreshUrlParams:{},e=a&&a.pageRefreshUrlParams?a.pageRefreshUrlParams:{};f.pageRefreshUrlParams={};b.extend(!0,f.pageRefreshUrlParams,c,e);"undefined"!==typeof g&&(f.deviceType=g.deviceType);
f.divToUpdateData=d();return f}}});n.when("A","jQuery","page-refresh-utils","cache","dp-click-to-ci-utils").register("web-ajax-utility",function(e,h,l,c,d){function b(a,b,c,d,e){this.scope=a;this.url=b;this.options=c;this.useCustomRefreshBehavior=e;this.status=0;this.selected=!1;this.error=this.successData=this.xhr=this._status=r;this.chunks=[];this.doNotAbort=d||!1}var k=new c;b._objects={};b.prototype._initializeChunks=function(){var a=!1;k.exists(this.url)&&(a=!0,this.chunks=k.get(this.url));return a};
b.prototype._callback=function(){var a=arguments[0],b=Array.prototype.slice.call(arguments,1);"function"===typeof a&&a.apply(self,b)};b.prototype._canAbort=function(){return!this.doNotAbort&&1===this.status};b.prototype._isAborted=function(){return 3===this.status};b.prototype._getUrl=function(){return this.url};b.prototype._abort=function(){if(1===this.status)try{this.ajaxRequestRefence.abort(),this.status=3}catch(b){var a={message:"Could not abort ajax request. "};"string"===typeof b&&(a.message+=
b,b=r);a.logLevel="FATAL";f.ueLogError&&f.ueLogError(b,a)}};b.prototype._flushChunkData=function(){var a=this;a.chunks.length&&h.map(a.chunks,function(b){a.useCustomRefreshBehavior||l.refreshFeature(b);a._callback(a.options.chunk,b)})};b.prototype._request=function(){var a=this;a.ajaxRequestRefence=e.get(a.url,{params:a.options.params,success:function(b,c,d){a.status=4;a.successData=b;a._status=c;a.xhr=d;k.put(a.url,a.chunks);a.chunks=[];a.selected&&(a.useCustomRefreshBehavior||l.removeOverlayForAllFeatures(),
a._callback(a.options.success,b,c,d));e.trigger("PageRefresh:Success")},error:function(b,c,d){a.status=2;a.xhr=b;a._status=c;a.error=d;a.selected&&(a.useCustomRefreshBehavior||l.removeOverlayForAllFeatures(),a._callback(a.options.error,b,c,d))},abort:function(b){a.status=3;a.xhr=b;a.selected&&a._callback(a.options.abort,b)},chunk:function(b){b&&(a.chunks.push(b),a.selected&&(a.useCustomRefreshBehavior||l.refreshFeature(b),a._callback(a.options.chunk,b)))},timeout:a.options.timeout||4E4})};b.prototype.getContent=
function(){b._abortRequestsExcept(this);this.selected=!0;var a=this._initializeChunks();a&&(this.status=4,d.logCounter("CachedTwisterUpdate"));0===this.status?(this.status=1,this._request()):1===this.status?this._flushChunkData():4===this.status&&(a?(this._flushChunkData(),this.useCustomRefreshBehavior||l.removeOverlayForAllFeatures(),this._callback(this.options.success,this.successData,this._status,this.xhr),e.trigger("a:pageUpdate"),e.trigger("PageRefresh:Success")):(this.status=1,this._request()))};
b._abortRequestsExcept=function(a){h.each(b._objects[a.scope],function(b,c){c._canAbort()&&b!==a._getUrl()&&c._abort()})};b.getInstance=function(a,c,d,e,h){if(!a||!c||"object"!==typeof d)throw"Incorrect parameter passed.";h=h||!1;b._objects[a]=b._objects[a]||{};var k=b._objects[a][c];k&&k._isAborted()&&(delete b._objects[a][c],k=r);k||(b._objects[a][c]=new b(a,c,d,e,h,this));return b._objects[a][c]};return b});n.when("A").register("state-aware-critical-features",function(e){return function(){var e=
[];this.add=function(f,c){for(var d=f.featureName,b=!1,k=0;k<e.length;k++)if(e[k].featureName===d){b=!0;break}if(b)throw"Critical Feature "+f.featureName+" already registered for State Aware Messaging!";f={};f.featureName=d;f.callback=c;e.push(f)};this.getAllCriticalFeatures=function(){return e}}});n.when("A","state-aware-parameter-handler").register("state-aware-feature-consolidator",function(e,f){return{getStateAwareParameters:function(){return f.getStateAwareParameters()}}});n.when("A","state-aware-critical-features",
"state-aware-parameters").register("state-aware-parameter-handler",function(e,h,l){return new function(){var c=new h,d=new l;this.registerCriticalFeature=function(b,d){try{if("function"===typeof d)c.add(b,d);else throw"callback needs to be a function!";}catch(a){f.ueLogError&&f.ueLogError(a,{logLevel:"ERROR",attribution:b.featureName,message:"StateAwareExceptionMessaging:- This error is caused by the feature "+b.featureName+" while registering itself as a critical feature for State Aware Messaging. "+
a})}};this.getStateAwareParameters=function(){for(var b=c.getAllCriticalFeatures(),e=0;e<b.length;e++){var a=b[e],h=a.featureName,a=a.callback.apply();try{d.putParameters(h,a)}catch(l){f.ueLogError&&f.ueLogError(l,{logLevel:"ERROR",attribution:h,message:"StateAwareMessaging:- This error is caused by the feature "+h+" while injecting state aware parameters. "+l})}}return d.getAllStateAwareParameters()}}});n.when("A").register("state-aware-parameters",function(){return function(){var e={};this.putParameters=
function(f,l){var c=!0;for(feature in e)if(e.hasOwnProperty(feature)&&f!==feature){var d=this.getParameters(feature);if(c){var c=l,b=!1;for(paramKey in c)if(c.hasOwnProperty(paramKey)&&d.hasOwnProperty(paramKey)){b=!0;break}c=!b}}if(c)for(paramKey in l)l.hasOwnProperty(paramKey)&&(d=l[paramKey],e[f]||(e[f]={}),e[f][paramKey]=d);else throw"Duplicate Parameters found for other Critical Feature!";};this.getParameters=function(f){return e[f]};this.getAllStateAwareParameters=function(){var f={},l;for(l in e)if(e.hasOwnProperty(l)){var c=
this.getParameters(l),d;for(d in c)c.hasOwnProperty(d)&&(f[d]=c[d])}return f}}});n.when("A").register("page-refresh-utils",function(e){var h=e.$,l={intermediateEOS:1,EOS:1};return{fadeInFeatures:function(c){h.each(c,function(b,d){"#"!==d[0]&&(c[b]="#"+d)});var d=c.join(",");h(d).addClass("js-feature-refresh-overlay");h(d).css("opacity",.5)},refreshFeature:function(c){var d=c.Value;c=c.FeatureName;if(!l[c]){var b,e;try{c&&d&&d.content&&(e=d.content[c],"undefined"!==typeof e&&(b=h("#"+c),b.html(e),
b.removeClass("js-feature-refresh-overlay"),b.css("opacity","")))}catch(a){d={message:"Error in feature"+(c||"NoFeatureName"),logLevel:"FATAL"},f.ueLogError&&f.ueLogError(a,d)}}},removeOverlayForAllFeatures:function(c){c=h("body").find(".js-feature-refresh-overlay");for(var d=0;d<c.length;d++){var b=c[d];h(b).removeClass("js-feature-refresh-overlay");h(b).css("opacity","")}}}})});